@using System.Globalization
@inject IOrderService OrderService;

<div class="product-item">
    <div class="product-info-container">
        <div>
            <MudText Typo="Typo.body1"><strong>@Name</strong></MudText>
            <MudText Typo="Typo.body2" Class="mb-1">@Description</MudText>
            <MudText Typo="Typo.body1">
                <strong>
                    @Price.ToString("N0", new NumberFormatInfo { NumberGroupSeparator = "." })
                </strong>
            </MudText>
        </div>
        <img src="@ImageUrl" width="80" />
    </div>
    <div class="mt-3 d-flex align-center">
        @if (!addMode)
        {
            <MudButton Color="Color.Primary" Variant="Variant.Outlined" Class="ml-auto" OnClick="OnAddBtnClicked">Add</MudButton>
        }
        else
        {
            <div class="d-flex align-center ml-auto">
                <MudIconButton Icon="@Icons.Material.Filled.Remove" Size="Size.Small" Color="Color.Primary" Variant="Variant.Outlined" OnClick="DecrementQty"></MudIconButton>
                <MudText Typo="Typo.body1" Color="Color.Primary" Class="mx-4"><strong>@qty</strong></MudText>
                <MudIconButton Icon="@Icons.Material.Filled.Add" Size="Size.Small" Color="Color.Primary" Variant="Variant.Outlined" OnClick="IncrementQty"></MudIconButton>
            </div>
        }
    </div>
</div>

@code {
    [Parameter] public string Id { get; set; } = null!;
    [Parameter] public string Name { get; set; } = null!;
    [Parameter] public string Description { get; set; } = null!;
    [Parameter] public long Price { get; set; }
    [Parameter] public string ImageUrl { get; set; } = null!;
    [Parameter] public bool Enabled { get; set; }

    private int qty = 0;
    private bool addMode = false;

    private void OnAddBtnClicked()
    {
        addMode = true;
        qty = 1;

        OrderService.AddItemToCart(Id, qty);
    }

    private void IncrementQty()
    {
        qty += 1;
        OrderService.AddItemToCart(Id, qty);
    }

    private void DecrementQty()
    {
        qty -= 1;

        if (qty == 0) {
            addMode = false;
            OrderService.RemoveItemFromCart(Id);
        }
        else {
            OrderService.AddItemToCart(Id, qty);
        }
    }
}
